# 大语言模型文字冒险游戏 - 使用说明

## 版本说明

本项目提供了四个版本的游戏：

1. **原始版本** (`llm_adventure_game.py`) - 使用HTML渲染，依赖tk_html_widgets
2. **简化版本** (`llm_adventure_game_simple.py`) - 使用标准Tkinter组件
3. **修复版本** (`llm_adventure_game_fixed.py`) - 使用数字输入选择选项
4. **最终版本** (`llm_adventure_game_final.py`) - **强烈推荐使用**，能够处理AI返回的纯文本格式

## 强烈推荐使用最终版本

最终版本解决了所有问题：
- ✅ 完全解决了AI响应格式解析问题
- ✅ 能够处理AI返回的纯文本格式
- ✅ 使用数字输入替代按钮选择
- ✅ 更稳定的界面显示
- ✅ 更好的错误处理
- ✅ 智能的文本解析算法

## 快速开始

### 1. 安装依赖
```bash
# Windows
install_simple.bat

# 或手动安装
pip install dashscope markdown2
```

### 2. 启动游戏
```bash
# Windows
run_final.bat

# 或直接运行
python llm_adventure_game_final.py
```

## 游戏操作指南

### 1. 设置阶段
1. 在"阿里云API-KEY"输入框中粘贴您的API Key
2. 在"故事背景设定"文本框中输入或修改故事背景
3. 点击"开始 / 重置游戏"按钮

### 2. 游戏进行
1. AI会生成故事情节和四个选项
2. 选项会显示在"当前选项"区域，编号为1-4
3. 在"你的选择"区域输入数字(1-4)选择选项
4. 按回车键或点击"确认选择"按钮提交选择
5. AI会根据您的选择继续生成故事

### 3. 调试功能
- 点击"显示AI原始响应"按钮可以查看AI的原始输出
- 如果遇到解析错误，会显示详细的错误信息

## 界面说明

### 游戏设置区域
- **阿里云API-KEY**: 输入您的阿里云百炼API密钥
- **故事背景设定**: 自定义游戏的初始背景
- **开始 / 重置游戏**: 开始新游戏或重置当前游戏
- **显示AI原始响应**: 查看AI的原始输出（调试用）

### 故事进展区域
- 显示完整的游戏故事历史
- 支持Markdown格式显示
- 自动滚动到最新内容

### 当前选项区域
- 显示AI生成的四个选项
- 每个选项都有编号(1-4)
- 选项内容会换行显示

### 你的选择区域
- **输入框**: 输入选项编号(1-4)
- **确认选择**: 提交您的选择
- 支持回车键快速提交

## 技术特点

### 智能文本解析
- 能够处理AI返回的纯文本格式
- 自动识别故事内容和选项
- 支持多种选项格式（**标题**-描述、数字编号等）
- 容错性强，即使格式不完全标准也能正常工作

### 数字输入选择
- 避免了按钮显示问题
- 更直观的选择方式
- 支持键盘操作

### 异步处理
- AI调用在后台进行
- 界面不会卡死
- 实时状态反馈

### 错误处理
- 详细的错误信息
- 友好的用户提示
- 自动重试机制

## 故障排除

### 常见问题

1. **"无法解析格式"错误**
   - 最终版本已经解决了这个问题
   - 如果仍有问题，点击"显示AI原始响应"查看AI的实际输出

2. **选项无法选择**
   - 确保输入的是1-4之间的数字
   - 确保选项已经生成（不是"暂无可用选项"）
   - 检查输入框是否被禁用

3. **API调用失败**
   - 检查API Key是否正确
   - 检查网络连接
   - 确认阿里云账户有足够的余额

4. **界面显示异常**
   - 确保已安装所有依赖包
   - 尝试重新启动游戏
   - 检查Python版本是否为3.7+

### 调试技巧

1. **查看AI原始响应**
   - 点击"显示AI原始响应"按钮
   - 可以看到AI的完整输出内容

2. **重新开始游戏**
   - 点击"开始 / 重置游戏"按钮
   - 这会清空所有历史记录

3. **检查控制台输出**
   - 在命令行中运行游戏可以看到详细的错误信息
   - 包括文本解析的详细过程

## 版本历史

### v1.0.0 (原始版本)
- 基础GUI界面
- HTML渲染支持
- 按钮选择方式

### v1.1.0 (简化版本)
- 移除HTML依赖
- 使用标准Tkinter组件
- 改进错误处理

### v1.2.0 (修复版本)
- 数字输入选择
- 强大的JSON解析
- 更好的用户体验

### v1.3.0 (最终版本) - 当前强烈推荐
- 智能文本解析
- 能够处理AI返回的纯文本格式
- 支持多种选项格式
- 完善的容错机制
- 最佳的用户体验

## 联系支持

如果遇到问题，请：
1. 查看"显示AI原始响应"中的内容
2. 检查控制台输出的错误信息
3. 确认所有依赖已正确安装
4. 验证API Key的有效性
5. 尝试使用最终版本 (`llm_adventure_game_final.py`) 